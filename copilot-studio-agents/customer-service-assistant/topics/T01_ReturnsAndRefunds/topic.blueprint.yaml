# -----------------------------------------------------------------------------
# Topic Blueprint: Returns and Refunds
# Agent: Customer Service Assistant
# Purpose: Help customers understand return eligibility and start a return
# -----------------------------------------------------------------------------

topic:
  name: ReturnsAndRefunds
  display_name: Returns and Refunds
  description: Help customers understand return eligibility and start a return.

  trigger:
    type: OnRecognizedIntent
    intent: ReturnsAndRefunds
    phrases:
      - I want to return an item
      - start a return
      - refund my order
      - how do returns work
      - return policy
      - I need a refund
      - can I send this back
      - return a damaged product
      - how do I get my money back
      - exchange an item
    # Note: Aim for 5-15 trigger phrases; keep them short and varied

  variables:
    - name: t_order_number
      type: string
      scope: topic
      description: Order number provided by customer.
    - name: t_return_reason
      type: string
      scope: topic
      description: Customer's reason for return.
    - name: t_is_eligible
      type: boolean
      scope: topic
      description: Eligibility decision for return window and condition.
    - name: t_next_step
      type: string
      scope: topic
      description: Instruction to customer (label, drop-off, etc.).

  flow:
    - node: Message
      id: msg_intro_001
      name: Intro
      text: I can help with returns and refunds. I'll ask two quick questions.

    - node: Question
      id: question_order_number_001
      name: AskOrderNumber
      prompt: What's your **order number**?
      save_to: t_order_number
      type_hint: Text
      validation:
        required: true

    - node: Question
      id: question_reason_001
      name: AskReason
      prompt: |
        What's the **reason** for the return?
        - Damaged
        - Wrong item
        - Changed mind
        - Other
      save_to: t_return_reason
      type_hint: Text
      validation:
        required: true

    - node: GenerativeAnswers
      id: gen_eligibility_001
      name: EligibilityCheck
      moderationLevel: High
      instructions: |
        Use the knowledge source **contoso-returns-policy.md** as the policy authority.

        Decide whether the return is eligible based on:
        - Order number: {t_order_number}
        - Reason: {t_return_reason}

        If eligible, give next steps in 3 bullets.

        If not eligible, explain why in 1 sentence and offer 2 alternative options (warranty, support).

        Ask exactly one follow-up question only if required (missing purchase date, missing condition).
      outputs:
        - t_is_eligible
        - t_next_step
      output_shape: "Return JSON with keys: isEligible (bool), nextStep (string)"

    - node: Condition
      id: condition_eligible_001
      name: CheckEligibility
      condition: t_is_eligible == true
      if_true:
        - node: Message
          id: msg_eligible_001
          name: EligibleResponse
          text: |
            Eligible. Here's what to do next:

            {t_next_step}
        - node: Message
          id: msg_offer_draft_001
          name: OfferDraft
          text: If you want, I can also draft the message you'll send to support.
      if_false:
        - node: Message
          id: msg_not_eligible_001
          name: NotEligibleResponse
          text: |
            Not eligible under the standard return policy.

            {t_next_step}
        - node: BeginDialog
          id: goto_warranty_001
          name: RedirectToWarranty
          topic: WarrantyInquiry
          # Note: Ensure WarrantyInquiry topic exists or remove this redirect

    - node: End
      id: end_topic_001
      name: EndTopic
