# -----------------------------------------------------------------------------
# Topic: Request Access
# Purpose: Collect access request details and optionally call a Power Automate
#          flow to create an IT ticket for provisioning.
# -----------------------------------------------------------------------------
topic:
  name: RequestAccess
  displayName: Request Access
  description: >-
    Collect access request details and optionally call a flow to create
    an IT ticket for provisioning.
  trigger:
    type: User says a phrase
    phrases:
      - I need access
      - request access to an app
      - need permissions
      - cannot log in
      - access request
      - I need VPN
      - I need github access
      - need microsoft 365 access
      - how do I get access to a system
      - request software access
      - I need access to sharepoint
  variables:
    - name: t_app_or_system
      type: string
      scope: topic
      description: System the user needs access to.
    - name: t_reason
      type: string
      scope: topic
      description: Business reason for the access request.
    - name: t_manager
      type: string
      scope: topic
      description: Manager name or email for approval.
    - name: t_request_summary
      type: string
      scope: topic
      description: Structured request summary generated by AI.
    - name: t_ticket_id
      type: string
      scope: topic
      description: IT ticket ID returned from the flow action.
  flow:
    - id: question_system_001
      node: Ask a question
      prompt: "Which **app or system** do you need access to? (Example: GitHub, VPN, Jira)"
      save_to: t_app_or_system

    - id: question_reason_002
      node: Ask a question
      prompt: What is the **reason** you need it? (One sentence)
      save_to: t_reason

    - id: question_manager_003
      node: Ask a question
      prompt: Who is your **manager** (name or email)?
      save_to: t_manager

    - id: genAnswers_summary_004
      node: Generative answers
      instructions: >-
        Create a structured access request summary.
        Include: system ({t_app_or_system}), reason ({t_reason}), manager ({t_manager}), urgency (low/normal/high).
        Output as 6 short bullets.
      outputs:
        - t_request_summary

    - id: message_showsummary_005
      node: Message
      text: |-
        Here is the request I will submit:

        {t_request_summary}

    - id: action_createticket_006
      node: Action (agent flow)
      name: Create IT ticket (optional)
      action_name: CreateITTicket
      inputs:
        system: t_app_or_system
        reason: t_reason
        manager: t_manager
      outputs:
        ticketId: t_ticket_id
      notes: >-
        If you build the flow, return a ticket ID so you can confirm success.
        See assets/sample-request.json for input format and
        assets/sample-flow-output.json for expected output.

    - id: condition_ticketcreated_007
      node: Condition
      condition: t_ticket_id is not empty
      then:
        - id: message_success_008
          node: Message
          text: "Your access request has been submitted. Ticket ID: {t_ticket_id}"
      else:
        - id: message_noticket_009
          node: Message
          text: "Your request summary has been prepared. Please submit it manually to IT if needed."

    - id: end_topic_010
      node: End
